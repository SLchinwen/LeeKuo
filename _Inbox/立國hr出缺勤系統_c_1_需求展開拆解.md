# HR 出缺勤系統（人臉／指紋辨識）
## C1｜需求展開拆解（Requirement Decomposition）

---

## 1. 文件定位與目的

本文件承接《業務需求與導入規劃說明（B1）》文件，目的在於：

- 將「業務制度描述」拆解為**可實作、可估工、可測試**的系統需求
- 作為後續 **PRD（C2）與系統設計（C3）** 的直接輸入文件
- 明確區分功能需求、規則需求與非功能需求，避免工程階段自行假設

文件屬性：
- 階段：20-design / C1
- 類型：需求展開拆解（Requirements Decomposition）
- 可見性：內部（internal）

---

## 2. 模組拆解總覽

本系統依業務邏輯拆分為以下核心模組：

1. 員工與身分治理模組
2. 刷卡 / 辨識資料整合模組
3. 點名與人工介入模組
4. 出勤判斷引擎模組
5. 加班與法規稽核模組
6. 月結算與假別生成模組
7. 通知與查詢模組

---

## 3. 模組一：員工與身分治理模組

### 3.1 功能需求
- 建立與維護員工基本資料
- 綁定人臉 / 指紋辨識 ID（一對多）
- 設定是否需刷卡、是否可加班
- 設定到職日與離職日

### 3.2 規則需求
- 員工狀態為「離職」後：
  - 不再參與出勤判斷
  - 不產生異常、補單、結算
- 歷史資料僅供查詢與稽核

### 3.3 非功能需求
- 員工狀態異動需具備生效日
- 所有異動需可追蹤

---

## 4. 模組二：刷卡 / 辨識資料整合模組

### 4.1 功能需求
- 匯入人臉 / 指紋刷卡 Log
- 支援多設備、多地點
- 支援單一設備進出共用

### 4.2 規則需求
- 原始 Log 不可修改、不刪除
- 短時間重複讀取需自動去重
- Log 僅作為事實層輸入

### 4.3 非功能需求
- 可處理大量資料（設備異常）
- 支援批次匯入與回補

---

## 5. 模組三：點名與人工介入模組

### 5.1 功能需求
- 提供現場點名功能
- 支援到班 / 請假 / 未到標記
- 支援批次補入出缺勤與加班

### 5.2 規則需求
- 點名僅在以下情境影響判斷層：
  - 卡機異常造成大量刷卡缺失
  - 跨班 / 留宿名單確認
- 點名資料不得覆蓋刷卡 Log

### 5.3 非功能需求
- 點名資料需標示來源與核准人

---

## 6. 模組四：出勤判斷引擎模組

### 6.1 功能需求
- 判斷上班日 / 假日
- 判斷上班 / 下班時間
- 計算上班工時

### 6.2 規則需求
- 第一筆有效進 = 上班時間
- 最後一筆有效出 = 下班時間
- 單一設備依時間序判斷

### 6.3 非功能需求
- 判斷結果需可重算
- 支援異動後回溯計算

---

## 7. 模組五：加班與法規稽核模組

### 7.1 功能需求
- 計算平日 / 假日加班
- 稽核每日與每月加班上限

### 7.2 規則需求
- 法定範圍內加班必須列入薪資
- 超過法定上限工時：
  - 轉換為加班工作點數 / 工作獎金基礎量

### 7.3 非功能需求
- 稽核規則需可設定與調整

---

## 8. 模組六：月結算與假別生成模組

### 8.1 功能需求
- 月結算出勤資料
- 自動產生假別紀錄

### 8.2 規則需求
- 無刷卡、無請假 → 曠職（AB）
- 工時不足未補 → 遲到（LT）/ 早退（ET）
- AB / LT / ET 僅系統可產生

### 8.3 非功能需求
- 月結算後結果需封存

---

## 9. 模組七：通知與查詢模組

### 9.1 功能需求
- 員工可查詢每日出勤狀態
- 系統每日一次發送刷卡異常通知
- **業務人員可進行遠端出差回報（新增）**

### 9.2 規則需求
- 刷卡異常通知：
  - 僅在「完全無刷卡資料」時發送
- 遠端出差回報規則：
  - 業務人員出差期間 **無設備刷卡資料**
  - 系統將判定為「無刷卡資料」之異常來源
  - 因此需以出差回報作為補登依據：
    - 出差到達照片
    - 出差離開照片
  - 出差回報定位為：
    - 與補刷卡相同層級之「出勤事實補登來源」」
  - 系統依每日出差回報：
    - **自動補入當日出缺勤資料**（不回寫原始刷卡 Log）
    - 作為該日上班 / 下班與工時計算依據
  - 長時間出差：
    - 仍需每日回報
    - 每日可記錄「到達」與「離開」狀態

### 9.3 非功能需求
- 出差照片需具備：
  - 時間戳記
  - 基本定位資訊（若可行）
- 避免過度通知與重複提醒

---

## 10. TBD 決策結論補充（已確認）

本章節補充並結案先前於 B1 / C1 文件中標示之 TBD 決策項目，以下規則自版本 1.0 起即為**正式制度假設**。

---

### 10.1 夜班 / 跨日班處理原則（結案）

- 立國工程**無三班制、無正式夜班班別**。
- 可能存在之情境為：
  - 現場留宿待命
  - 因留宿導致未刷退，或隔日才刷退

#### 制度處理原則

- 留宿不視為夜班、不視為跨日班
- 留宿本身 **不列入加班工時**
- 留宿需填寫：
  - 加班申請單（若實際有工作）
  - 留宿單（作為住宿與津貼依據）

#### 系統行為

- 因留宿造成當日刷卡異常：
  - 系統標示為異常（不自動判定曠職）
  - 員工需補填：
    - 加班單（如有實際工作）
    - 留宿單（不計入加班）
- 留宿單：
  - 不影響加班計算
  - 觸發留宿津貼發放（津貼系統或薪資系統處理）

---

### 10.2 管理職 / 不計加班人員之處理原則（結案）

#### 身分定義

- 員工可被標記為：
  - 不計算加班人員
  - 或由部門層級統一設定

#### 制度處理原則（補充）

- 不計算加班人員：
  - 不納入系統自動加班稽核（勞基法工時上限）
  - 刷卡超過班表下班時間時：
    - 預設註記為「留廠未投入工作」
    - 或由系統依上下班工時自動判定並產生該註記
  - 不自動產生加班時數

#### 系統行為

- 系統仍完整保留刷卡與實際出勤事實
- 加班若確有投入工作：
  - 一律需填寫加班申請單
  - 於申請單流程中控管合法性與合理性
- 上述註記僅作為稽核與說明用途，不影響出勤工時結果

---

## 11. 更新後之成熟度狀態

- 主要制度 TBD：**已全數結案**
- 僅保留未來擴充型議題（如成本分攤細節）
- 本文件可直接作為：
  - C2 PRD 的穩定輸入
  - 工程估工與排程依據

---

## 12. 下一步指引

- 進入 **C2｜PRD（產品需求文件）**
- 建議 PRD 章節優先順序：
  1. 出勤判斷引擎
  2. 點名與留宿 / 加班單流程
  3. 法規稽核與例外身分處理

> 本文件已消除關鍵制度 TBD，可視為 1.0 穩定版本。

