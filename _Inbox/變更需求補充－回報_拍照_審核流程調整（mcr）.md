<!-- Generated by Prompt: requirement-change-addendum.md -->
<!-- Stage: 20-design -->
<!-- Date: 2026-01-29 -->
---
title: "變更需求補充－回報×拍照×審核流程調整（MCR）"
date: "2026-01-29"

# 治理與歸屬
organization: "client-project"
client: "立國工程股份有限公司"
project: "MaintCloud Report（MCR）"
module: "現場回報與文件產出"

# 文件屬性
category: "spec"
type: "Requirements"

# 生命週期
status: "Draft"
approval_status: "internal"
needs_review: true
confidence: 0.8

# 發布控制
visibility: "internal"
publish_target: "none"

# 來源追溯
origin: "ai-generated"
authoring_mode: "assistant"
prompt_id: "requirement-change-addendum"
prompt_stage: "20-design"
generation_mode: "prompt-driven"
---

# 變更需求補充－回報×拍照×審核流程調整（MCR）

## 0. 背景與目的

由於請款與結案資料來源以「現場回報」為主，且本次需求已將「回報」與「拍照」拆成兩條可獨立運行的流程線（由工序欄位 need_report / need_photo 控制），因此既有回報系統需進行 UI、驗證、審核與文件產出機制的調整。

本補充文件聚焦於三項變更：
1) 回報流程不再一律強制拍照；
2) 文件產出（Excel/Word）需可依工序欄位過濾；
3) 審核流程要縮短，並允許「退回」與「已回報後持續補拍/換圖」且保留歷史。

---

## 1. 變更摘要（對齊會議結論）

### CHG-01 回報 UI 與拍照檢核拆線
* 若工序 need_photo=否，回報完成不需檢核照片。
* 若工序 need_photo=是，回報可先完成，但需在後續補齊照片（可設定為「待補件」狀態）。

### CHG-02 文件產出可依工序欄位過濾
* 生成 Excel / Word 時，允許依下列條件篩選：
  - 是否回報（need_report）
  - 是否拍照（need_photo）
  - 其他工序欄位（例如停駐點區域群組、吊車噸數）

### CHG-03 審核縮短：完成回報可退回；已回報工序可續拍與換圖
* 完成回報後，審核端可「退回」要求補件。
* 已回報之工序允許：
  - 繼續上傳照片
  - 更換照片（但需保留歷史版本以備追溯）

---

## 2. 需求展開（Functional Requirements）

### FR-RPT-01 工序回報可獨立完成（不強制拍照）
* 系統需支援「回報」與「拍照」兩條線獨立運行。
* 回報提交時：
  - 若 need_photo=否：直接可完成回報
  - 若 need_photo=是：可完成回報，但回報狀態應標示照片是否已補齊（例：PhotoPending / PhotoCompleted）

**驗證規則（VR-RPT-01）**
* need_photo=否：不得阻擋回報提交
* need_photo=是：若未上傳照片，不得標示為 PhotoCompleted

**驗收條件（AC-RPT-01）**
* 同一工序在 need_photo=否 的情境下，回報流程不出現拍照必填錯誤

---

### FR-RPT-02 回報清單與拍照入口依工序欄位自動呈現
* 回報清單：僅顯示 need_report=是 的工序
* 拍照入口：僅顯示 need_photo=是 的工序（或在工序明細中顯示「拍照」頁籤）

**VR-RPT-02**
* need_report=否：不得出現在回報清單
* need_photo=否：不得出現拍照入口或拍照必填提示

---

### FR-DOC-01 文件產出支援條件過濾（Excel/Word）

系統在生成 Excel/Word 報表時需提供「篩選條件」：
* 依工序欄位：need_report / need_photo / parking_zone_group / crane_tonnage（可選）
* 依狀態：回報狀態、審核狀態、照片完成狀態

**VR-DOC-01**
* 篩選條件必須被記錄於報表 metadata（例如：產出時間、操作者、篩選條件摘要）

**AC-DOC-01**
* 同一批資料以不同篩選條件產出，報表內容可預期且可追溯

---

### FR-APR-01 審核端支援「退回」

* 審核者可對「已回報」工序執行退回，要求補件/修正。
* 退回需填寫原因（可用範本＋自由文字）。

**VR-APR-01**
* 退回時必須填原因
* 退回後狀態應回到「待補件」或「需重回報」（狀態字典 TBD）

**AC-APR-01**
* 退回後，現場人員能清楚看到退回原因與需補項目

---

### FR-PHO-01 已回報工序允許續拍與換圖（保留歷史）

* 允許在工序已回報後追加照片。
* 允許更換照片：
  - 新照片上傳後成為「目前使用版本」
  - 舊照片需保留為歷史版本（不可刪除或需受權限控管）

**VR-PHO-01**
* 每次換圖需留存：操作者、時間、原因（可選/必填 TBD）
* 系統需能標示：目前版本（Current）與歷史版本（History）

**AC-PHO-01**
* 報表/文件產出若引用照片，應能預設使用「目前版本」，並可切換為包含歷史

---

## 3. 狀態與資料（建議的最小狀態模型）

> 此處先定義最小可落地版本，避免過度設計；完整狀態機可於 PRD/System Design 深化。

### 3.1 工序回報狀態（Report Status）
* Draft（未提交）
* Reported（已回報）
* Returned（已退回待補件）
* Approved（已核定）

### 3.2 照片狀態（Photo Status，僅 need_photo=是 才有意義）
* NotRequired（不需拍照）
* Pending（需拍照但未完成）
* Completed（已完成）

### 3.3 審核狀態（Approval Status）
* N/A（不需審核，TBD 是否存在）
* Pending
* Returned
* Approved

---

## 4. 需會議鎖定的決策點（TBD List）

1. need_photo=是時，回報是否允許直接完成？（目前建議：允許，但標示 Photo Pending）
2. 退回後是否要求重新回報，或僅補照片/補說明即可？
3. 換圖是否需要填寫原因？（建議：至少選填；若已送出請款/關帳後則必填）
4. 歷史照片是否允許刪除？（建議：不允許；若需，僅管理者可做且需留痕）
5. 報表預設引用照片版本：Current only 或包含 History？（建議：預設 Current）

---

## 5. 對既有文件的影響（需同步更新）

* Scenario 文件：
  - SC-04 現場完工回報
  - SC-07 監工核定
  - SC-08 試算請款/關帳
* Requirement Decomposition：
  - 新增回報/拍照拆線、退回、換圖版本治理需求

> ⚠️ 建議將本補充文件在需求確認會後合併回主線文件，避免規格分散。

