# 出缺勤系統｜流程圖

- **日期：** 2026-02-02
- **用途：** 以 Mermaid 描述出缺勤系統主要流程，供 PRD、開發與客戶確認對齊。
- **來源：** B1、C1、出缺勤系統_情境彙整

---

## 1. 日常自動流程（SC-01）

```mermaid
flowchart LR
  A[匯入刷卡/辨識 Log] --> B[短時間重複去重]
  B --> C[第一筆進/最後一筆出]
  C --> D[判斷上班日/假日]
  D --> E[計算上班工時與加班]
  E --> F[標示異常待處理]
```

- **說明：** 事實層（Log）不可變；判斷層可重算。單一設備依時間序判斷進出。

---

## 2. 每日異常與補單（SC-02）

```mermaid
flowchart TD
  A[系統檢查前一日出勤] --> B{完全無刷卡?}
  B -->|是| C[發送一次異常通知給員工]
  B -->|否| D[不發通知]
  C --> E[員工補請假/補刷卡或點名佐證]
  E --> F[補登寫入判斷層，不覆寫 Log]
```

- **說明：** 異常通知僅在「完全無刷卡資料」時發送；補登僅影響判斷層。

---

## 3. 點名輔助流程（SC-03：設備故障／大量異常）

```mermaid
flowchart TD
  A[卡機異常/大量刷卡缺失] --> B[HR/現場啟用點名模式]
  B --> C[勾選到班/請假/未到名單]
  C --> D[批次補入出缺勤與加班]
  D --> E[留存異常原因與核准紀錄]
  E --> F[點名資料不覆蓋刷卡 Log]
```

- **說明：** 點名僅在卡機異常或跨班／留宿確認時影響判斷層；需標示來源與核准人。

---

## 4. 月結算流程（SC-04）

```mermaid
flowchart TD
  A[3 日：補單截止] --> B[4 日：檢核補缺]
  B --> C[5 日：執行結算]
  C --> D[無刷卡無請假→曠職 AB]
  C --> E[工時不足未補→遲到 LT/早退 ET]
  D --> F[系統寫入假別紀錄]
  E --> F
  F --> G[封存結果供薪資系統讀取]
```

- **說明：** 補單與月結時序已客戶確認：**3 日截止**（補單）→ **4 日檢核補缺** → **5 日執行結算**。AB／LT／ET 僅系統可產生；月結後結果封存。見 客戶確認用_規劃摘要 §3.6、§7。

---

## 5. 出差回報補登（SC-05）

```mermaid
flowchart TD
  A[業務出差無設備刷卡] --> B[系統判定無刷卡異常]
  B --> C[業務填寫出差回報]
  C --> D[每日到達/離開照片]
  D --> E[系統依回報自動補入當日出缺勤]
  E --> F[不回寫原始刷卡 Log]
```

- **說明：** 出差回報與補刷卡同級，為「出勤事實補登來源」；長時間出差仍須每日回報。

---

## 6. 新進／離職與身分治理（SC-06、SC-07）

```mermaid
flowchart TD
  subgraph 新進
    N1[建立員工主檔] --> N2[綁定人臉/指紋 ID]
    N2 --> N3[設定是否可加班]
    N3 --> N4[測試辨識或點名一次]
  end
  subgraph 離職
    L1[HR 登錄離職日] --> L2[系統停止出勤比對]
    L2 --> L3[不再產生異常與補單]
    L3 --> L4[歷史資料封存供查詢]
  end
```

---

## 7. As-Is 與 To-Be 對照（概念）

### 7.1 As-Is（導入前）

```mermaid
flowchart LR
  A[多據點分散刷卡] --> B[人臉短時重複雜訊]
  B --> C[單一設備進出難區分]
  C --> D[設備故障靠人工補登]
  D --> E[月底集中補單易爭議]
```

### 7.2 To-Be（導入後）

```mermaid
flowchart LR
  A[匯入 Log 去重] --> B[系統判斷上下班與工時]
  B --> C[異常即時提示/每日通知]
  C --> D[點名/出差可補登]
  D --> E[月結前補單關閉後封存]
  E --> F[可稽核可追溯可重算]
```

---

## 8. 三層資料與流程定位

```mermaid
flowchart TD
  subgraph 事實層
    F1[刷卡/辨識 Log]
  end
  subgraph 判斷層
    J1[上下班時間/工時/加班]
    J2[異常標記/AB/LT/ET]
  end
  subgraph 人工介入層
    R1[請假/加班單/點名/出差回報]
  end
  F1 --> J1
  R1 --> J1
  J1 --> J2
```

- **原則：** 人工介入僅影響判斷層，不可回寫事實層 Log。
