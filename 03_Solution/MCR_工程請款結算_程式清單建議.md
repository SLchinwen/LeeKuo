# MCR 工程請款結算｜程式清單建議

- **日期：** 2026-02-26
- **版本：** v0.4（MCR330／MCR340 邊界與建檔欄位細分）
- **用途：** 供權限矩陣表與 PRD／規格對照；建檔採整批匯入、程式編碼獨立。
- **依據：** `internal_docs/程式編碼原則_共用規範.md`、PRD 第二階段、工程規格草案、MCR SOP 請款流程。

---

## 0. 請款結算資料流（摘要）

| 階段 | 產物／建檔 | 說明 |
| --- | --- | --- |
| **合約簽訂時** | 工作項目與項次、單價、預計數量 | **客戶合約工作項目建檔**、**客戶設備對應工作項目建檔**，採**整批匯入**；程式編碼**獨立**（不附屬於其他主程式） |
| **實際清洗完工** | 完成數量 | 依實際完工結算完成數量，據以**回報完工請款試算**、**設備追加請款**、**合約完工結算確認** |
| **結算與輸出** | 設備請款、請款總表 | **結算設備請款查詢與輸出**、**結算請款總表查詢與輸出** |

---

## 1. 主作業與百位數約定

| 主作業 | 百位數 | 說明 |
| --- | --- | --- |
| 現場回報／審核／報表（既有） | 1xx、2xx | MCR100～MCR231 已用於廠區／設備／工序／合約／案件／回報／審核／報表／看板 |
| **工程請款結算** | **3xx** | 合約／設備工作項目建檔（整批匯入）、回報完工請款試算、設備追加請款、合約完工結算確認、結算查詢與輸出 |

---

## 2. 主程式清單（登錄權限表）

主要 e 化主作業依客戶確認改為下列清單；**客戶合約工作項目建檔**與**客戶設備對應工作項目建檔**採**整批匯入**，程式編碼**獨立**，不附屬於 MCR310。

| 程式代號 | 程式名稱 | 用途說明 | 備註 |
| --- | --- | --- | --- |
| **MCR300** | 請款結算目錄 | 請款結算作業入口／選單 | 選單入口 |
| **MCR310** | 客戶合約工作項目建檔 | 各客戶合約之工作項目與項次、單價建檔；**先選合約**後**整批匯入**（不提供單筆新增）；重新匯入可清除原資料重匯；匯入後檢查未對應項目並提示至 MCR320 | 合約簽訂時提供；程式編碼**獨立**；雛型與操作說明見 `03_Solution/2026-02-26_prototype_MCR310*` |
| **MCR320** | 客戶設備對應工作項目建檔 | 每座設備對應之工作項次、預計數量建檔；**整批匯入** | 合約簽訂時提供；程式編碼**獨立** |
| **MCR330** | 回報完工請款試算 | 採用**設備對應的標準工作項次、數量**，**套入新合約單價**，複製成**本次合約該設備的請款資料**，產生**試算資料**；若已於 MCR340 輸入追加，可於試算檢視追加結果 | 主要 e 化主作業 |
| **MCR340** | 設備追加請款建立 | **結算前**輸入追加：僅可增加**合約工作項目中標記為追加項**之項目；另可對**非追加項目**做**加成調整**（填百分比，如 80%、120%、200%）；試算可檢視追加結果 | 主要 e 化主作業 |
| **MCR350** | 合約完工結算確認 | 合約完工結算之確認（含監工核定、關帳後鎖定） | 主要 e 化主作業 |
| **MCR360** | 結算設備請款查詢與輸出 | 結算後設備請款明細之查詢與輸出（文件產出） | 主要 e 化主作業 |
| **MCR370** | 結算請款總表查詢與輸出 | 結算請款總表之查詢與輸出（文件產出） | 主要 e 化主作業 |

---

## 3. 建檔方式說明（MCR310、MCR320）

| 程式代號 | 建檔名稱 | 建檔方式 | 主要欄位／用途 |
| --- | --- | --- | --- |
| **MCR310** | 客戶合約工作項目建檔 | **整批匯入**（不提供單筆新增） | 合約、項次、工作項目名稱、單位、數量、單價、總價、**追加項識別**；**作業要點**：先選入合約→下載匯入範本／批次匯入；重新匯入時提醒是否清除原資料，確認「是」則標記刪除原資料並全部新增重匯；匯入後檢查設備工作項目是否對應到新合約，未對應者提示並引導至 MCR320 更新 |
| **MCR320** | 客戶設備對應工作項目建檔 | **整批匯入** | 設備（設備類型／編號／名稱）、工作項次、**數量**、**加成**（**預設的加成比例**，百分比欄位如 80%、120%、200%）；建檔時即有預設加成，後續可於 **加成作業**（MCR340）上**開放調整** |

※ **工作項次小計**計算公式：**完成數量 × 單價 × 加成比率**。實際請款時依**實際清洗完工**結算**完成數量**，單價來自 MCR310 建檔；加成比率以 MCR320 建檔之**預設加成**為準，可於 MCR340 **加成作業**上開放調整；追加與加成規則見 §3.1。

### 3.1 MCR330 與 MCR340 邊界與規則

| 項目 | 說明 |
| --- | --- |
| **MCR330 回報完工請款試算** | 採用**設備對應的標準工作項次、數量**（來自 MCR320），**套入新合約單價**（來自 MCR310），**複製**成**本次合約該設備的請款資料**，產生**試算資料**。若該設備有回報**二次清洗**或**追加**，並於**結算前**在 MCR340 輸入追加，可**於試算檢視追加的結果**。 |
| **MCR340 設備追加請款建立** | **結算前**輸入追加。**追加**僅可增加**合約工作項目中標記為追加項**的項目（於 MCR310 建檔時識別）。另可於**加成作業**上對**非追加項目**做**加成調整**（建檔時 MCR320 已有**預設加成比例**，此處**開放調整**，填百分比如 80%、120%、200%）。 |
| **試算與追加關係** | 於 MCR340 建立之追加，可於 MCR330 試算畫面**檢視追加結果**；結算確認（MCR350）前完成追加與加成調整。 |
| **工作項次小計公式** | **工作項次小計 = 完成數量 × 單價 × 加成比率**（單價來自 MCR310；加成比率以 MCR320 **預設加成**為準，可於 MCR340 **加成作業**開放調整）。 |

---

## 4. 角色與主程式權限對照（建議）

| 角色 | MCR300 | MCR310 | MCR320 | MCR330 | MCR340 | MCR350 | MCR360 | MCR370 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 專案經理 | 可執行 | 可執行 | 可執行 | 可執行 | 可執行 | 可執行 | 可執行 | 可執行 |
| 請款人員 | 可執行 | 可執行（匯入） | 可執行（匯入） | 可執行 | 可執行 | 可執行（確認依權限） | 可執行 | 可執行 |
| 監工／客戶主管 | 可查詢 | 可查詢 | 可查詢 | 可查詢 | 可查詢 | 可執行（核定）／可查詢 | 可查詢 | 可查詢 |
| 現場人員 | — | — | — | — | — | — | — | — |

※ 實際權限以您與客戶確認之**權限矩陣表**為準；上表僅供討論用。

---

## 5. 與既有 MCR 程式之關係

| 既有程式（第一階段／回報） | 與請款結算之關係 |
| --- | --- |
| MCR210 現場人員設備工序回報 | 回報核定後，設備可進行完工回報，作為**回報完工請款試算**（MCR330）前置 |
| MCR220 回報審核 | 審核通過後工序才可納入請款試算 |
| MCR230／MCR231 報表／看板 | 與請款結算為不同主作業；請款結算以 MCR3xx 區隔 |

---

## 6. 請您確認或調整的項目

1. **程式代號 MCR310～MCR370** 與程式名稱對應是否正確？
2. **整批匯入**之檔案格式、欄位對應與錯誤處理是否需另立規格？
3. **角色權限**（§4）是否要增減角色或調整可執行／可查詢？
4. **MCR310 追加項識別**之欄位名稱與枚舉（如「是否追加項」Y/N 或 類型）是否與合約表單一致？
5. **MCR320 加成**欄位之預設值與百分比上限／下限是否需規範？

確認後可進行：

- 將主程式代號寫入**權限矩陣表**與**模組與程式代號架構**文件。
- 將本清單與 **表單與名詞對照**、**API 端點**、**整批匯入規格** 對齊後納入工程規格或 PRD 附錄。
