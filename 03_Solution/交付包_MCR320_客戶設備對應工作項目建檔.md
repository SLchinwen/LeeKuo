# 交付包｜MCR320 客戶設備對應工作項目建檔

- **程式代號：** MCR320
- **程式名稱：** 客戶設備對應工作項目建檔
- **交付對象：** 協作工程團隊
- **產出日期：** 2026-01-30
- **依據：** [協作與治理規範](../internal_docs/協作與治理規範.md) §2.4、[docs 治理規範](../internal_docs/docs_治理規範.md) §6 標準分析產出要求

本交付包彙整 MCR320 開發所需之需求、權限、情境、欄位對照及雛型與範本，供工程方進行框架設計、TABLE 命名、API 命名與權限實作。

---

## 1. 模組與主程式代碼

| 項目 | 說明 |
| --- | --- |
| **模組代號** | MCR（維護合約回報／工程請款結算） |
| **主程式代號** | MCR320 |
| **程式名稱** | 客戶設備對應工作項目建檔 |
| **所屬主作業** | 工程請款結算（3xx） |
| **備註** | 程式編碼獨立；對應廠區設備清單，**不對應合約**。建檔以整批匯入為主，不提供單筆新增。子程式、批次、API／TABLE 命名依 [程式編碼原則｜共用規範](../internal_docs/程式編碼原則_共用規範.md) §4～§5。 |

---

## 2. 程式 × 使用者角色權限矩陣表

| 角色 | MCR320 權限 | 備註 |
| --- | --- | --- |
| 專案經理 | 可執行 | 設備工作項目建檔、匯入、查詢、匯出、編輯／刪除 |
| 請款人員 | 可執行（匯入） | 以匯入與查詢為主 |
| 監工／客戶主管 | 可查詢 | 僅查詢，不開放匯入或修改 |
| 現場人員 | — | 不開放本程式 |

※ 實際權限以與客戶確認之權限矩陣表為準；完整矩陣見 [MCR 工程請款結算｜程式清單建議](MCR_工程請款結算_程式清單建議.md) §4。

---

## 3. 對應情境說明

| 情境 | 操作者角色 | 可執行操作 | 驗收／備註 |
| --- | --- | --- | --- |
| 設備建檔（依廠區+設備） | 專案經理、請款人員 | 先選廠區 → 選單一設備（依維修廠區設備清單）→ 下載匯入範本 → 填寫 CSV → 批次匯入 | 未選廠區或設備時匯入／查詢前阻擋並提示 |
| 設備或工作項異動 | 專案經理、請款人員 | 重新匯入時系統詢問是否清除原資料；確認「是」則標記刪除原資料並全部新增重匯 | 維持完整性 |
| 對應不到合約單價提示 | 專案經理、請款人員 | 匯入或載入查詢時顯示「對應不到最新合約工作項目單價」筆數；可點選列清單；清單中該筆以紅色顯示 | 引導至 MCR310 補建合約工作項目 |
| 查詢與匯出 | 專案經理、請款人員、監工／客戶主管 | 依廠區與設備查詢、匯出全部 Excel | 依角色僅查詢或可編輯 |
| 單筆修正 | 專案經理、請款人員 | 清單上編輯／刪除單筆；加成比例後續可於 MCR340 加成作業調整 | 以批次匯入為主 |

---

## 4. 模組欄位名稱中英文對照表（MCR320 清單／匯入）

| 中文（UI／表單） | 英文（API/DB 建議） | 用途／說明 |
| --- | --- | --- |
| 廠區 | factory_id / area_id | 維修廠區；選定後帶出設備清單 |
| 設備編號 | equipment_id / device_id | 單一設備；依廠區篩選 |
| 設備名稱 | equipment_name / device_name | 設備名稱 |
| 項次 | item_no / seq_display | 顯示用項次（如 1.1.1） |
| 工作項目名稱 | work_item_name | 工作項目名稱 |
| 數量 | qty | 數量 |
| 加成比例 | multiplier_rate / bonus_rate | 預設加成比例（如 80%、100%、120%、200%） |
| 異動日期 | updated_at / modified_date | 最後異動日期（畫面僅顯示此欄，不顯示建立人、異動人、建立日期） |
| 操作 | — | 編輯／刪除（UI 用） |

※ 表單與報表欄位須與客戶對齊；新增欄位時請同步更新 [表單與名詞對照清單_欄位引用標準](表單與名詞對照清單_欄位引用標準.md)。

---

## 5. 雛型與操作說明

| 項目 | 說明與連結 |
| --- | --- |
| **雛型（對外）** | 可開啟 [docs/prototype/2026-02-26_prototype_MCR320.html](../docs/prototype/2026-02-26_prototype_MCR320.html) 作為操作畫面與互動參考；表列畫面僅保留「異動日期」，不顯示建立人、異動人、建立日期；未對應合約單價之列以紅色顯示。 |
| **操作說明** | [2026-02-26_prototype_MCR320_操作說明.md](2026-02-26_prototype_MCR320_操作說明.md) |
| **匯入範本** | [2026-02-26_prototype_MCR320_匯入範本.csv](2026-02-26_prototype_MCR320_匯入範本.csv)（UTF-8 BOM）；欄位：設備編號、設備名稱、項次、工作項目名稱、數量、加成比例 |
| **對外操作手冊** | [docs/MCR/操作手冊.md](../docs/MCR/操作手冊.md) 內 MCR320 章節 |

---

## 6. 業務規則摘要

- **廠區 + 單一設備**：須先選擇廠區，再選擇單一設備（依維修廠區設備清單）；未選時不可匯入或查詢。
- **不對應合約**：本作業建檔設備之標準工作項目與加成，不對應合約；合約單價由 MCR310 建檔，MCR330 試算時套用。
- **對應檢查**：匯入或載入查詢時可呈現「對應不到最新合約工作項目單價」之筆數；清單中無法對應的該筆以紅色顯示，並可點選提示列清單。
- **重新匯入**：若該設備已有工作項目資料，再次批次匯入時提醒「是否清除原有資料」；確認「是」則標記刪除原資料並全部新增重匯。
- **無單筆新增**：本程式以批次匯入為主，不提供「新增」按鈕；單筆僅支援清單上編輯／刪除。
- **依廠區帶出設備清單**：廠區選定後，設備下拉選單需依維修廠區設備清單動態帶出；僅能選擇單一設備。

---

## 7. 相關文件索引

| 文件 | 路徑／說明 |
| --- | --- |
| 程式清單與權限 | [MCR_工程請款結算_程式清單建議.md](MCR_工程請款結算_程式清單建議.md) |
| 請款流程參考 | [MCR_請款流程_參考.md](MCR_請款流程_參考.md) |
| 工程規格草案 | [工程規格草案_MCR_第二階段.md](工程規格草案_MCR_第二階段.md) |
| PRD 第二階段 | [PRD_立國工程_MCR_第二階段.md](PRD_立國工程_MCR_第二階段.md) |
| 欄位對照標準 | [表單與名詞對照清單_欄位引用標準.md](表單與名詞對照清單_欄位引用標準.md) |

---

*本交付包依治理要求產出，若需求或權限有變更請以 PRD／程式清單與客戶確認版為準。*
