<!-- Generated by Prompt: requirement-decomposition.md -->
<!-- Stage: 20-design -->
<!-- Date: 2026-01-29 -->
---
title: "需求展開－MCR 基本資料匯入 × 吊車 × 請款"
date: "2026-01-29"

# 治理與歸屬
organization: "client-project"
client: "立國工程股份有限公司"
project: "MaintCloud Report（MCR）"
module: "基礎資料與請款治理"

# 文件屬性
category: "spec"
type: "Requirements"

# 生命週期
status: "Draft"
approval_status: "internal"
needs_review: true
confidence: 0.75

# 發布控制
visibility: "internal"
publish_target: "none"

# 來源追溯
origin: "ai-generated"
authoring_mode: "assistant"
prompt_id: "requirement-decomposition"
prompt_stage: "20-design"
generation_mode: "prompt-driven"
---

# 需求展開－MCR 基本資料匯入 × 吊車 × 請款

> 本文件目的：
> 將「作業情境與使用者旅程（Scenario）」與「匯入表單治理文件」中的需求，
> 展開為 **工程可實作的功能需求、資料需求、驗證規則與驗收條件**，
> 作為後續 PRD 與 System Design 的唯一依據。

---

## 1. 需求範圍與不在範圍（Scope）

### 1.1 納入範圍

* 基本資料匯入（廠區、設備、型式工序、工作項目、加成、設備請款項目）
* 吊車排程所需資料欄位與彙總依賴
* 請款試算所需之資料一致性與治理規則

### 1.2 明確不在範圍（Out of Scope）

* 吊車實際排程演算法
* ERP/財務系統串接
* 發票開立與稅務流程

---

## 2. 匯入治理的共同原則（全表適用）

### R-GEN-01 主鍵治理
* 所有匯入資料必須能形成明確主鍵或自然鍵
* 不允許隱性覆寫（需明確指定 overwrite / new version）

### R-GEN-02 參照完整性
* 下游表單匯入前，必須檢核上游主檔是否存在

### R-GEN-03 可追溯性
* 所有匯入動作需保留：匯入批次、時間、操作者、成功/失敗筆數

### R-GEN-04 失敗不污染
* 匯入失敗資料不可部分寫入正式資料表

---

## 3. 廠區清單（Site Master）需求展開

### FR-SITE-01 匯入與更新
* 系統須支援廠區清單批次匯入
* 主鍵：廠區代號

### VR-SITE-01 驗證規則
* 廠區代號：必填、不可重複
* 客戶統編：僅允許數字或空白

### AC-SITE-01 驗收條件
* 匯入後，廠區可被設備、工作項目、加成表正確引用

---

## 4. 設備清單（Equipment Master）需求展開

### FR-EQP-01 匯入與更新
* 主鍵：廠區代號 + 設備編號

### FR-EQP-02 吊車停駐點欄位
* 系統須支援「吊車停駐點區」欄位
* 僅作為預設值，不直接決定派車

### VR-EQP-01 驗證規則
* 廠區代號必須存在於 Site Master
* 是否啟用：僅允許 是/否

### AC-EQP-01 驗收條件
* 停用設備不出現在回報與請款選單

---

## 5. 設備型式工序（Equipment Process Template）需求展開

### FR-PROC-01 工序模板建立
* 主鍵：型號 + 工序代碼（TBD）

### FR-PROC-02 吊車與回報控制欄位
* 吊車噸數：數值、可空
* 是否回報 / 是否拍照：Boolean
* 停駐點區域群組：字串

### VR-PROC-01 驗證規則
* 若填吊車噸數，停駐點區域不可空白

### AC-PROC-01 驗收條件
* need_report=否 → 工序不出現在回報清單
* need_photo=否 → 系統不要求上傳照片

---

## 6. 廠區標準工作項目需求展開

### FR-WI-01 母版維護
* 主鍵：廠區代號 + 項次代號

### VR-WI-01 驗證規則
* 單價需為正數

### AC-WI-01 驗收條件
* 可被下載為合約工作項目來源

---

## 7. 設備請款項目需求展開

### FR-BILL-01 設備請款對應
* 主鍵：設備 + 項次代號

### FR-BILL-02 加成選用
* 系統須依加成代號表自動帶入比率

### VR-BILL-01 驗證規則
* 項次代號必須存在於合約工作項目版本（未來）

### AC-BILL-01 驗收條件
* 試算請款金額正確反映加成

---

## 8. 加成代號表需求展開

### FR-SUR-01 加成主檔
* 主鍵：廠區代號 + 加成代號

### VR-SUR-01 驗證規則
* 比率需為整數
* 生效日期不可晚於使用日期

### AC-SUR-01 驗收條件
* 加成於試算中正確套用

---

## 9. 回報系統調整需求（新增）

> 因回報資料為請款、吊車與文件產出的主要來源，原有回報系統需配合本次需求進行結構性調整。

---

### 9.1 回報與拍照流程拆分（UI / 行為調整）

#### FR-REP-01 回報與拍照雙軌流程
* 系統須將「工序回報」與「拍照上傳」拆為兩條可獨立運作的流程
* 工序是否需要拍照，須依 **設備型式工序.need_photo** 判斷

#### VR-REP-01 驗證規則
* need_photo = 否：
  - 回報完成時不得檢查照片是否存在
* need_photo = 是：
  - 回報可先完成，但標示為「待補照片」狀態
  - PhotoPending 仍可核定/請款

#### AC-REP-01 驗收條件
* 不需拍照之工序，可在無任何照片情況下完成回報
* UI 上需清楚區分「回報完成」與「照片完成」狀態
* PhotoPending 可進入核定/請款流程

---

### 9.2 文件產出依工序條件過濾

#### FR-DOC-01 文件輸出條件控制
* 系統於產出 Excel / Word 文件時，須可依工序欄位進行篩選
  - 是否回報（need_report）
  - 是否拍照（need_photo）

#### VR-DOC-01 驗證規則
* need_report = 否：
  - 該工序不得出現在任何回報型文件中

#### AC-DOC-01 驗收條件
* 匯出文件內容與系統中可見工序清單一致
* 篩選條件可被追溯（文件中標註篩選依據）

---

### 9.3 回報後調整與圖片換圖機制

#### FR-REP-02 回報後退回機制
* 已完成回報之工序，需支援「退回」操作
* 退回僅影響回報狀態，不刪除既有資料

#### FR-REP-03 拍照可補拍 / 換圖
* 已回報之工序，可持續上傳照片
* 新上傳照片可取代既有照片，但需保留歷史紀錄

#### VR-REP-02 驗證規則
* 圖片更換需記錄：
  - 更換時間
  - 操作者
  - 原圖與新圖關聯

#### AC-REP-02 驗收條件
* 客戶可於審核期間要求補拍或換圖
* 系統可追溯每次圖片異動歷史
* 退回後可重新回報

---

### 9.4 設備完工回報（可請款通知）

#### FR-CMP-01 設備完工回報
* 系統需提供「設備完工回報」入口，供專案經理提交
* 作為請款整理/文件產出的前置條件

#### VR-CMP-01 驗證規則
* 完工回報可重開修改（關帳前）

#### AC-CMP-01 驗收條件
* 完工回報後，設備可進入請款整理流程

---

## 10. 與 PRD / 系統設計的依賴關係（更新）

* 本文件 → PRD（回報 UI、狀態設計、文件輸出條件、完工回報）
* PRD → System Design（資料表：回報狀態、照片版本、審核流程）

> ⚠️ 若後續 PRD 未納入「回報/拍照雙軌」、「換圖歷史」、「文件篩選條件」，視為需求遺漏，需回到本文件補正後才能往下進行。

